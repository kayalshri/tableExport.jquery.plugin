!function(t){t.fn.extend({tableExport:function(e){function n(e,n,l,r){return E=t(w).find(e).first().find(n),E.each(function(){j="",o(this,l,A,r+E.length,function(t,e,n){j+=i(t,e,n)+v.csvSeparator}),j=t.trim(j).substring(0,j.length-1),j.length>0&&(k.length>0&&(k+="\n"),k+=j),A++}),E.length}function o(e,n,o,l,r){if(-1==t.inArray(o,v.ignoreRow)&&-1==t.inArray(o-l,v.ignoreRow)){var a=t(e).filter(function(){return"none"!=t(this).data("tableexport-display")&&(t(this).is(":visible")||"always"==t(this).data("tableexport-display")||"always"==t(this).closest("table").data("tableexport-display"))}).find(n),s=0;a.each(function(e){if(("always"==t(this).data("tableexport-display")||"none"!=t(this).css("display")&&"hidden"!=t(this).css("visibility")&&"none"!=t(this).data("tableexport-display"))&&-1==t.inArray(e,v.ignoreColumn)&&-1==t.inArray(e-a.length,v.ignoreColumn)&&"function"==typeof r){var n,l,i=0,c=0;if("undefined"!=typeof N[o]&&N[o].length>0)for(n=0;e>=n;n++)"undefined"!=typeof N[o][n]&&(r(null,o,n),delete N[o][n],e++);for(t(this).is("[colspan]")&&(i=parseInt(t(this).attr("colspan")),s+=i>0?i-1:0),t(this).is("[rowspan]")&&(c=parseInt(t(this).attr("rowspan"))),r(this,o,e),n=0;i-1>n;n++)r(null,o,e+n);if(c)for(l=1;c>l;l++)for("undefined"==typeof N[o+l]&&(N[o+l]=[]),N[o+l][e+s]="",n=1;i>n;n++)N[o+l][e+s-n]=""}})}}function l(t){if(v.consoleLog===!0&&console.log(t.output()),"string"===v.outputMode)return t.output();if("base64"===v.outputMode)return b(t.output());try{var e=t.output("blob");saveAs(e,v.fileName+".pdf")}catch(n){m(v.fileName+".pdf","data:application/pdf;base64,",t.output())}}function r(t,e,n){var o=0;if("undefined"!=typeof n&&(o=n.colspan),o>=0){for(var l=t.width,r=t.textPos.x,a=e.table.columns.indexOf(e.column),s=1;o>s;s++){var i=e.table.columns[a+s];l+=i.width}if(o>1&&("right"===t.styles.halign?r=t.textPos.x+l-t.width:"center"===t.styles.halign&&(r=t.textPos.x+(l-t.width)/2)),t.width=l,t.textPos.x=r,"undefined"!=typeof n&&n.rowspan>1&&("middle"===t.styles.valign?t.textPos.y=t.textPos.y+t.height*(n.rowspan-1)/2:"bottom"===t.styles.valign&&(t.textPos.y+=(n.rowspan-1)*t.height),t.height=t.height*n.rowspan),"middle"===t.styles.valign||"bottom"===t.styles.valign){var c="string"==typeof t.text?t.text.split(/\r\n|\r|\n/g):t.text,f=c.length||1;f>2&&(t.textPos.y-=(2-x)/2*e.row.styles.fontSize*(f-2)/3)}return!0}return!1}function a(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function s(t,e,n){return t.replace(new RegExp(a(e),"g"),n)}function i(t,e,n){var o="";if(null!=t){var l=f(t,e,n),r=null===l||""==l?"":l.toString();l instanceof Date?o=v.csvEnclosure+l.toLocaleString()+v.csvEnclosure:(o=s(r,v.csvEnclosure,v.csvEnclosure+v.csvEnclosure),(o.indexOf(v.csvSeparator)>=0||/[\r\n ]/g.test(o))&&(o=v.csvEnclosure+o+v.csvEnclosure))}return o}function c(t){return t=t||"0",t=s(t,v.numbers.html.decimalMark,"."),t=s(t,v.numbers.html.thousandsSeparator,""),"number"==typeof t||jQuery.isNumeric(t)!==!1?t:!1}function f(e,n,o){var l="";if(null!=e){var r=t(e),a=r.html();if("function"==typeof v.onCellHtmlData&&(a=v.onCellHtmlData(r,n,o,a)),v.htmlContent===!0)l=t.trim(a);else{var s=a.replace(/\n/g,"\u2028").replace(/<br\s*[\/]?>/gi,"⁠"),i=t("<div/>").html(s).contents();if(s="",t.each(i.text().split("\u2028"),function(e,n){e>0&&(s+=" "),s+=t.trim(n)}),t.each(s.split("⁠"),function(e,n){e>0&&(l+="\n"),l+=t.trim(n).replace(/\u00AD/g,"")}),v.numbers.html.decimalMark!=v.numbers.output.decimalMark||v.numbers.html.thousandsSeparator!=v.numbers.output.thousandsSeparator){var f=c(l);if(f!==!1){var d=(""+f).split(".");1==d.length&&(d[1]="");var u=d[0].length>3?d[0].length%3:0;l=(0>f?"-":"")+(v.numbers.output.thousandsSeparator?(u?d[0].substr(0,u)+v.numbers.output.thousandsSeparator:"")+d[0].substr(u).replace(/(\d{3})(?=\d)/g,"$1"+v.numbers.output.thousandsSeparator):d[0])+(d[1].length?v.numbers.output.decimalMark+d[1]:"")}}}v.escape===!0&&(l=escape(l)),"function"==typeof v.onCellData&&(l=v.onCellData(r,n,o,l))}return l}function d(t,e,n){return e+"-"+n.toLowerCase()}function u(t,e){var n=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,o=n.exec(t),l=e;return o&&(l=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]),l}function h(e){var n=p(e,"text-align"),o=p(e,"font-weight"),l=p(e,"font-style"),r="";return"start"==n&&(n="rtl"==p(e,"direction")?"right":"left"),o>=700&&(r="bold"),"italic"==l&&(r+=l),""==r&&(r="normal"),{style:{align:n,bcolor:u(p(e,"background-color"),[255,255,255]),color:u(p(e,"color"),[0,0,0]),fstyle:r},colspan:parseInt(t(e).attr("colspan"))||0,rowspan:parseInt(t(e).attr("rowspan"))||0}}function p(t,e){try{return window.getComputedStyle?(e=e.replace(/([a-z])([A-Z])/,d),window.getComputedStyle(t,null).getPropertyValue(e)):t.currentStyle?t.currentStyle[e]:t.style[e]}catch(n){}return""}function y(t,e,n){var o=100,l=p(t,e),r=l.match(/\d+/);if(null!==r){r=r[0];var a=document.createElement("div");a.style.overflow="hidden",a.style.visibility="hidden",t.parentElement.appendChild(a),a.style.width=o+n;var s=o/a.offsetWidth;return t.parentElement.removeChild(a),r*s}return 0}function m(t,e,n){var o=window.navigator.userAgent;if(o.indexOf("MSIE ")>0||o.match(/Trident.*rv\:11\./)){var l=document.createElement("iframe");l&&(document.body.appendChild(l),l.setAttribute("style","display:none"),l.contentDocument.open("txt/html","replace"),l.contentDocument.write(n),l.contentDocument.close(),l.focus(),l.contentDocument.execCommand("SaveAs",!0,t),document.body.removeChild(l))}else{var r=document.createElement("a");r&&(r.style.display="none",r.download=t,e.toLowerCase().indexOf("base64,")>=0?r.href=e+b(n):r.href=e+encodeURIComponent(n),document.body.appendChild(r),document.createEvent?(null==C&&(C=document.createEvent("MouseEvents")),C.initEvent("click",!0,!1),r.dispatchEvent(C)):document.createEventObject?r.fireEvent("onclick"):"function"==typeof r.onclick&&r.onclick(),document.body.removeChild(r))}}function g(t){t=t.replace(/\x0d\x0a/g,"\n");for(var e="",n=0;n<t.length;n++){var o=t.charCodeAt(n);128>o?e+=String.fromCharCode(o):o>127&&2048>o?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}function b(t){var e,n,o,l,r,a,s,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",f=0;for(t=g(t);f<t.length;)e=t.charCodeAt(f++),n=t.charCodeAt(f++),o=t.charCodeAt(f++),l=e>>2,r=(3&e)<<4|n>>4,a=(15&n)<<2|o>>6,s=63&o,isNaN(n)?a=s=64:isNaN(o)&&(s=64),c=c+i.charAt(l)+i.charAt(r)+i.charAt(a)+i.charAt(s);return c}var v={consoleLog:!1,csvEnclosure:'"',csvSeparator:",",csvUseBOM:!0,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],ignoreRow:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{styles:{cellPadding:2,rowHeight:12,fontSize:8,fillColor:255,textColor:50,fontStyle:"normal",overflow:"ellipsize",halign:"left",valign:"middle"},headerStyles:{fillColor:[52,73,94],textColor:255,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:245},tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},numbers:{html:{decimalMark:".",thousandsSeparator:","},output:{decimalMark:".",thousandsSeparator:","}},onCellData:null,onCellHtmlData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"},x=1.15,w=this,C=null,S=[],E=[],A=0,N=[],j="";if(t.extend(!0,v,e),"csv"==v.type||"txt"==v.type){var k="",M=0;if(A=0,M+=n("thead",v.theadSelector,"th,td",M),M+=n("tbody",v.tbodySelector,"td",M),n("tfoot",v.tbodySelector,"td",M),k+="\n",v.consoleLog===!0&&console.log(k),"string"===v.outputMode)return k;if("base64"===v.outputMode)return b(k);try{var P=new Blob([k],{type:"text/"+("csv"==v.type?"csv":"plain")+";charset=utf-8"});saveAs(P,v.fileName+"."+v.type,"csv"!=v.type||v.csvUseBOM===!1)}catch(D){m(v.fileName+"."+v.type,"data:text/"+("csv"==v.type?"csv":"plain")+";charset=utf-8,"+("csv"==v.type&&v.csvUseBOM?"\ufeff":""),k)}}else if("sql"==v.type){A=0;var L="INSERT INTO `"+v.tableName+"` (";if(S=t(w).find("thead").first().find(v.theadSelector),S.each(function(){o(this,"th,td",A,S.length,function(t,e,n){L+="'"+f(t,e,n)+"',"}),A++,L=t.trim(L),L=t.trim(L).substring(0,L.length-1)}),L+=") VALUES ",E=t(w).find("tbody").first().find(v.tbodySelector),E.each(function(){j="",o(this,"td",A,S.length+E.length,function(t,e,n){j+="'"+f(t,e,n)+"',"}),j.length>3&&(L+="("+j,L=t.trim(L).substring(0,L.length-1),L+="),"),A++}),L=t.trim(L).substring(0,L.length-1),L+=";",v.consoleLog===!0&&console.log(L),"string"===v.outputMode)return L;if("base64"===v.outputMode)return b(L);try{var P=new Blob([L],{type:"text/plain;charset=utf-8"});saveAs(P,v.fileName+".sql")}catch(D){m(v.fileName+".sql","data:application/sql;charset=utf-8,",L)}}else if("json"==v.type){var O=[];S=t(w).find("thead").first().find(v.theadSelector),S.each(function(){var t=[];o(this,"th,td",A,S.length,function(e,n,o){t.push(f(e,n,o))}),O.push(t)});var T=[];E=t(w).find("tbody").first().find(v.tbodySelector),E.each(function(){var t=[];o(this,"td",A,S.length+E.length,function(e,n,o){t.push(f(e,n,o))}),t.length>0&&(1!=t.length||""!=t[0])&&T.push(t),A++});var B=[];B.push({header:O,data:T});var I=JSON.stringify(B);if(v.consoleLog===!0&&console.log(I),"string"===v.outputMode)return I;if("base64"===v.outputMode)return b(I);try{var P=new Blob([I],{type:"application/json;charset=utf-8"});saveAs(P,v.fileName+".json")}catch(D){m(v.fileName+".json","data:application/json;charset=utf-8;base64,",I)}}else if("xml"===v.type){A=0;var R='<?xml version="1.0" encoding="utf-8"?>';R+="<tabledata><fields>",S=t(w).find("thead").first().find(v.theadSelector),S.each(function(){o(this,"th,td",A,E.length,function(t,e,n){R+="<field>"+f(t,e,n)+"</field>"}),A++}),R+="</fields><data>";var W=1;if(E=t(w).find("tbody").first().find(v.tbodySelector),E.each(function(){var t=1;j="",o(this,"td",A,S.length+E.length,function(e,n,o){j+="<column-"+t+">"+f(e,n,o)+"</column-"+t+">",t++}),j.length>0&&"<column-1></column-1>"!=j&&(R+='<row id="'+W+'">'+j+"</row>",W++),A++}),R+="</data></tabledata>",v.consoleLog===!0&&console.log(R),"string"===v.outputMode)return R;if("base64"===v.outputMode)return b(R);try{var P=new Blob([R],{type:"application/xml;charset=utf-8"});saveAs(P,v.fileName+".xml")}catch(D){m(v.fileName+".xml","data:application/xml;charset=utf-8;base64,",R)}}else if("excel"==v.type||"xls"==v.type||"word"==v.type||"doc"==v.type){var H="excel"==v.type||"xls"==v.type?"excel":"word",U="excel"==H?"xls":"doc",z="xls"==U?'xmlns:x="urn:schemas-microsoft-com:office:excel"':'xmlns:w="urn:schemas-microsoft-com:office:word"',q=t("table"),K="";q.each(function(){A=0,K+="<table><thead>",S=t(this).find("thead").first().find(v.theadSelector),S.each(function(){j="",o(this,"th,td",A,S.length,function(e,n,o){if(null!=e){j+='<th style="';for(var l in v.excelstyles)v.excelstyles.hasOwnProperty(l)&&(j+=v.excelstyles[l]+": "+t(e).css(v.excelstyles[l])+";");t(e).is("[colspan]")&&(j+='" colspan="'+t(e).attr("colspan")),t(e).is("[rowspan]")&&(j+='" rowspan="'+t(e).attr("rowspan")),j+='">'+f(e,n,o)+"</th>"}}),j.length>0&&(K+="<tr>"+j+"</tr>"),A++}),K+="</thead><tbody>",E=t(this).find("tbody").first().find(v.tbodySelector),E.each(function(){j="",o(this,"td",A,S.length+E.length,function(e,n,o){if(null!=e){j+='<td style="';for(var l in v.excelstyles)v.excelstyles.hasOwnProperty(l)&&(j+=v.excelstyles[l]+": "+t(e).css(v.excelstyles[l])+";");t(e).is("[colspan]")&&(j+='" colspan="'+t(e).attr("colspan")),t(e).is("[rowspan]")&&(j+='" rowspan="'+t(e).attr("rowspan")),j+='">'+f(e,n,o)+"</td>"}}),j.length>0&&(K+="<tr>"+j+"</tr>"),A++}),v.displayTableName&&(K+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+f(t("<p>"+v.tableName+"</p>"))+"</td></tr>"),K+="</tbody></table>",v.consoleLog===!0&&console.log(K)});var F='<html xmlns:o="urn:schemas-microsoft-com:office:office" '+z+' xmlns="http://www.w3.org/TR/REC-html40">';if(F+='<meta http-equiv="content-type" content="application/vnd.ms-'+H+'; charset=UTF-8">',F+="<head>","excel"===H&&(F+="<!--[if gte mso 9]>",F+="<xml>",F+="<x:ExcelWorkbook>",F+="<x:ExcelWorksheets>",F+="<x:ExcelWorksheet>",F+="<x:Name>",F+=v.worksheetName,F+="</x:Name>",F+="<x:WorksheetOptions>",F+="<x:DisplayGridlines/>",F+="</x:WorksheetOptions>",F+="</x:ExcelWorksheet>",F+="</x:ExcelWorksheets>",F+="</x:ExcelWorkbook>",F+="</xml>",F+="<![endif]-->"),F+="</head>",F+="<body>",F+=K,F+="</body>",F+="</html>",v.consoleLog===!0&&console.log(F),"string"===v.outputMode)return F;if("base64"===v.outputMode)return b(F);try{var P=new Blob([F],{type:"application/vnd.ms-"+v.type});saveAs(P,v.fileName+"."+U)}catch(D){m(v.fileName+"."+U,"data:application/vnd.ms-"+H+";base64,",F)}}else if("png"==v.type)html2canvas(t(w)[0],{allowTaint:!0,background:"#fff",onrendered:function(t){var e=t.toDataURL();e=e.substring(22);for(var n=atob(e),o=new ArrayBuffer(n.length),l=new Uint8Array(o),r=0;r<n.length;r++)l[r]=n.charCodeAt(r);if(v.consoleLog===!0&&console.log(n),"string"===v.outputMode)return n;if("base64"===v.outputMode)return b(e);try{var a=new Blob([o],{type:"image/png"});saveAs(a,v.fileName+".png")}catch(s){m(v.fileName+".png","data:image/png;base64,",e)}}});else if("pdf"==v.type)if(v.jspdf.autotable===!1){var $={dim:{w:y(t(w).first().get(0),"width","mm"),h:y(t(w).first().get(0),"height","mm")},pagesplit:!1},Q=new jsPDF(v.jspdf.orientation,v.jspdf.unit,v.jspdf.format);Q.addHTML(t(w).first(),v.jspdf.margins.left,v.jspdf.margins.top,$,function(){l(Q)})}else{var V=v.jspdf.autotable.tableExport;if("string"==typeof v.jspdf.format&&"bestfit"===v.jspdf.format.toLowerCase()){var Y={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},G="",J="",Z=0;t(w).filter(":visible").each(function(){if("none"!=t(this).css("display")){var e=y(t(this).get(0),"width","pt");if(e>Z){e>Y.a0[0]&&(G="a0",J="l");for(var n in Y)Y.hasOwnProperty(n)&&Y[n][1]>e&&(G=n,J="l",Y[n][0]>e&&(J="p"));Z=e}}}),v.jspdf.format=""==G?"a4":G,v.jspdf.orientation=""==J?"w":J}V.doc=new jsPDF(v.jspdf.orientation,v.jspdf.unit,v.jspdf.format),t(w).filter(function(){return"none"!=t(this).data("tableexport-display")&&(t(this).is(":visible")||"always"==t(this).data("tableexport-display"))}).each(function(){var e,n=0;if(V.columns=[],V.rows=[],V.rowoptions={},"function"==typeof V.onTable&&V.onTable(t(this),v)===!1)return!0;v.jspdf.autotable.tableExport=null;var l=t.extend(!0,{},v.jspdf.autotable);v.jspdf.autotable.tableExport=V,l.margin={},t.extend(!0,l.margin,v.jspdf.margins),l.tableExport=V,"function"!=typeof l.beforePageContent&&(l.beforePageContent=function(t){if(1==t.pageCount){var e=t.table.rows.concat(t.table.headerRow);e.forEach(function(e){e.height>0&&(e.height+=(2-x)/2*e.styles.fontSize,t.table.height+=(2-x)/2*e.styles.fontSize)})}}),"function"!=typeof l.createdHeaderCell&&(l.createdHeaderCell=function(t,e){if("undefined"!=typeof V.columns[e.column.dataKey]){var n=V.columns[e.column.dataKey];t.styles.halign=n.style.align,"inherit"===l.styles.fillColor&&(t.styles.fillColor=n.style.bcolor),"inherit"===l.styles.textColor&&(t.styles.textColor=n.style.color),"inherit"===l.styles.fontStyle&&(t.styles.fontStyle=n.style.fstyle)}}),"function"!=typeof l.createdCell&&(l.createdCell=function(t,e){var n=V.rowoptions[e.row.index+":"+e.column.dataKey];"undefined"!=typeof n&&"undefined"!=typeof n.style&&(t.styles.halign=n.style.align,"inherit"===l.styles.fillColor&&(t.styles.fillColor=n.style.bcolor),"inherit"===l.styles.textColor&&(t.styles.textColor=n.style.color),"inherit"===l.styles.fontStyle&&(t.styles.fontStyle=n.style.fstyle))}),"function"!=typeof l.drawHeaderCell&&(l.drawHeaderCell=function(t,e){var n=V.columns[e.column.dataKey];return 1!=n.style.hasOwnProperty("hidden")||n.style.hidden!==!0?r(t,e,n):!1}),"function"!=typeof l.drawCell&&(l.drawCell=function(t,e){var n=V.rowoptions[e.row.index+":"+e.column.dataKey];return r(t,e,n)}),S=t(this).find("thead").find(v.theadSelector),S.each(function(){e=0,o(this,"th,td",n,S.length,function(t,n,o){var l=h(t);l.title=f(t,n,o),l.key=e++,V.columns.push(l)}),n++});var a=0;E=t(this).find("tbody").find(v.tbodySelector),E.each(function(){var l=[];e=0,o(this,"td",n,S.length+E.length,function(n,o,r){if("undefined"==typeof V.columns[e]){var s={title:"",key:e,style:{hidden:!0}};V.columns.push(s)}if(null!==n)V.rowoptions[a+":"+e++]=h(n);else{var s=t.extend(!0,{},V.rowoptions[a+":"+(e-1)]);s.colspan=-1,V.rowoptions[a+":"+e++]=s}l.push(f(n,o,r))}),l.length&&(V.rows.push(l),a++),n++}),"function"==typeof V.onBeforeAutotable&&V.onBeforeAutotable(t(this),V.columns,V.rows,l),V.doc.autoTable(V.columns,V.rows,l),"function"==typeof V.onAfterAutotable&&V.onAfterAutotable(t(this),l),v.jspdf.autotable.startY=V.doc.autoTableEndPosY()+l.margin.top}),l(V.doc),V.columns.length=0,V.rows.length=0,delete V.doc,V.doc=null}return this}})}(jQuery);
